import { Box, Link, Text, BlockStack, InlineStack, Badge } from "@shopify/polaris"
import ReportSummaryInfoCard from "./ReportSummaryInfoCard"
import Issue from "./Issue"
import func from "@/util/func"

function Category({ index, issue, subCategoryMap }) {
    const severity = func.getRunResultSeverity(issue.vulnerableTestingRunResults[0], subCategoryMap)
    return (
        <Box id={issue.testName}>
            <BlockStack gap="400">
                <BlockStack gap={200}>
                    <InlineStack gap={200}>
                        <Text variant='headingMd'>2.{index + 1} {issue.testName}</Text>

                        <div className={`badge-wrapper-${severity}`}>
                            <Badge size="small">{func.toSentenceCase(severity)}</Badge>
                        </div>

                        <Badge size="small"><Text variant="bodySm">{issue.vulnerableTestingRunResults.length} API affected</Text></Badge>
                    </InlineStack>
                    <Text>{issue.issueDescription}</Text>
                </BlockStack>

                <InlineStack gap={100}>
                    <Text variant="headingSm">Category:</Text>
                    <Text variant="headingSm" color="subdued">{issue.superCategory.shortName}</Text>
                </InlineStack>

                <BlockStack gap={100}>
                    <Text variant="headingSm">Impact</Text>
                    <Text>{issue.issueImpact}</Text>
                </BlockStack>

                {   
                    issue.vulnerableTestingRunResults.map((vulnerableTestingRunResult, index) => {
                        return ( <Issue testResults={issue.testResults} vulnerableApi={vulnerableTestingRunResult} cwes={(issue?.cwe || [])} references={(issue?.references || [])} /> )
                    })
                }
                
            </BlockStack>
        </Box>
    );
}

export default Category