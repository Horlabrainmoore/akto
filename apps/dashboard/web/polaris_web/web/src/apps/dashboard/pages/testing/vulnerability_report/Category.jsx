import { Box, Divider, Link, Text, BlockStack } from "@shopify/polaris"
import ReportSummaryInfoCard from "./ReportSummaryInfoCard"
import Issue from "./Issue"

function Category({ index, categoryName, categoryIssues, categoryMap, categoryVsApisCountMap }) {

    const categoryDisplayName = categoryMap?.[categoryName]?.displayName || ""

    const categorySummaryItems = [
        {
            title: "Total issues",
            data: categoryVsApisCountMap[categoryName],
        }, 
        {
            title: "Total test templates",
            data: categoryIssues.length
        }
    ]

    return (
        <Box id={categoryName} paddingBlockStart={600} paddingBlockEnd={800} paddingInlineStart={500} paddingInlineEnd={500}>
            <BlockStack gap="400">
                <Text variant='headingMd'>
                    2.{index + 1} {categoryDisplayName}
                </Text>
                <ReportSummaryInfoCard summaryItems={categorySummaryItems} />
                <Box>
                    <BlockStack gap="200">
                        <Text variant='headingSm'>
                            Issues
                        </Text>
                        <BlockStack gap="200">
                            {categoryIssues.length > 0 && categoryIssues.map((issueDetails, index) => {
                                const name = issueDetails?.name
                                const testName = issueDetails?.testName
                                return (
                                    <Link key={index} url={`#${name}`} removeUnderline>
                                        <Text variant='bodySm' color='subdued'>
                                            {index + 1}. {testName}
                                        </Text>
                                    </Link>
                                )
                            })}
                        </BlockStack>
                    </BlockStack>
                </Box>
                <Divider/>
                <Box>
                    {categoryIssues.map((issueDetails, index) => {
                        return (
                            <Issue key={index} issueDetails={issueDetails} index={index} isLast={index === categoryIssues.length - 1}/>
                        )
                    })}
                </Box>
            </BlockStack>
        </Box>
    );
}

export default Category